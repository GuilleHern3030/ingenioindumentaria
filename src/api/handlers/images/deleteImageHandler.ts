import request from '../../controllers/images/deleteImageController.ts'
import Article from '../../objects/Article.ts'
import handleError from '../errorHandler.ts'
import { isAdminSignedIn } from '../../index.ts'

/**
 * Upload an image to DataBase
 * @param img Image in FormData
 * @param article Article object to which the changes will be applied
 * @returns Promise with JSON object with format { src:string, size:string } 
 */
export const deleteImage = async(img:Record<string, any>, article:Article|undefined):Promise<any> => new Promise(async(resolve, reject) => {

    if (isAdminSignedIn() === true) try {

        // Solicitar la petici贸n al Backend
        const response = await request(img.src)
        
        // Borra la imagen del Article
        if (article !== undefined && Article.isArticle(article))
            article.deleteImage(img)

        // Devuelve la respuesta del Backend
        console.log(response)
        resolve(response)


    } catch(err:any) { reject(handleError(err)) }
    else reject("La sesi贸n caduc贸. Vuelve a iniciar sesi贸n para continuar.")
})

export default deleteImage